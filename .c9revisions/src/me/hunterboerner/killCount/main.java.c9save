{"ts":1360963022044,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"package me.hunterboerner.killCount;\r\n\r\nimport java.util.HashMap;\r\nimport java.util.Map;\r\n\r\nimport org.bukkit.GameMode;\r\nimport org.bukkit.command.Command;\r\nimport org.bukkit.command.CommandSender;\r\nimport org.bukkit.entity.*;\r\nimport org.bukkit.event.EventHandler;\r\nimport org.bukkit.event.Listener;\r\nimport org.bukkit.event.entity.EntityDeathEvent;\r\nimport org.bukkit.event.entity.PlayerDeathEvent;\r\nimport org.bukkit.event.player.PlayerJoinEvent;\r\n\r\npublic class main extends org.bukkit.plugin.java.JavaPlugin implements Listener {\r\n    Map<String, Integer> kills = new HashMap<String, Integer>();\r\n    Map<String, Integer> deaths = new HashMap<String, Integer>();\r\n\r\n    public void onEnable() {\r\n        getLogger().info(\r\n                \"KillCount \" + this.getDescription().getVersion()\r\n                        + \" has been enabled.\");\r\n        getServer().getPluginManager().registerEvents(this, this);\r\n        getServer().getMessenger().registerOutgoingPluginChannel(this,\r\n                \"KillCount\");\r\n        getServer().getMessenger().registerOutgoingPluginChannel(this,\r\n                \"DeathCount\");\r\n        try {\r\n            kills = SLAPI.load(this.getDataFolder() + \"/kills.bin\");\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        try {\r\n            deaths = SLAPI.load(this.getDataFolder() + \"/deaths.bin\");\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n\r\n    public void onDisable() {\r\n        getLogger().info(\r\n                \"Kill Count \" + this.getDescription().getVersion()\r\n                        + \" has been disabled\");\r\n    }\r\n\r\n    @EventHandler\r\n    public void onPlayerDeath(PlayerDeathEvent playerDeath) {\r\n        String dead = playerDeath.getEntity().getName();\r\n        int deathCount = 0;\r\n        if (deaths.get(dead) != null) {\r\n            deathCount = deaths.get(dead);\r\n        }\r\n        deathCount++;\r\n        deaths.put(dead, deathCount);\r\n\r\n        if (playerDeath.getEntity().getListeningPluginChannels()\r\n                .contains(\"KillCount\")) {\r\n            String deathString = deathCount + \"\";\r\n            playerDeath.getEntity().sendPluginMessage(\r\n                    this,\r\n                    \"DeathCount\",\r\n                    deathString.getBytes(java.nio.charset.Charset\r\n                            .forName(\"UTF-8\")));\r\n            try {\r\n                SLAPI.save(deaths, this.getDataFolder() + \"/deaths.bin\");\r\n            } catch (Exception e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n\r\n    @EventHandler\r\n    public void onDeath(EntityDeathEvent death) {\r\n        Player killer = death.getEntity().getKiller();\r\n        if (killer != null && killer.getGameMode() != GameMode.CREATIVE) {\r\n            int killCount = 0;\r\n            if (kills.get(killer.getName()) != null) {\r\n                killCount = kills.get(killer.getName());\r\n            }\r\n            killCount++;\r\n            kills.put(killer.getName(), killCount);\r\n\r\n            if (killer.getListeningPluginChannels().contains(\"KillCount\")) {\r\n                String killString = killCount + \"\";\r\n                killer.sendPluginMessage(this, \"KillCount\", killString\r\n                        .getBytes(java.nio.charset.Charset.forName(\"UTF-8\")));\r\n                try {\r\n                    SLAPI.save(kills, this.getDataFolder() + \"/kills.bin\");\r\n                } catch (Exception e) {\r\n                    e.printStackTrace();\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    @EventHandler\r\n    public void onPlayerJoin(PlayerJoinEvent join) {\r\n        final PlayerJoinEvent join2 = join;\r\n        getServer().getScheduler().scheduleSyncDelayedTask(this,\r\n                new Runnable() {\r\n\r\n                    public void run() {\r\n                        if (join2.getPlayer().getListeningPluginChannels()\r\n                                .contains(\"KillCount\")) {\r\n                            int killCount = 0;\r\n                            if (kills.get(join2.getPlayer().getName()) != null) {\r\n                                killCount = kills.get(join2.getPlayer()\r\n                                        .getName());\r\n                            }\r\n                            String killString = killCount + \"\";\r\n                            join2.getPlayer().sendPluginMessage(\r\n                                    main.this,\r\n                                    \"KillCount\",\r\n                                    killString\r\n                                            .getBytes(java.nio.charset.Charset\r\n                                                    .forName(\"UTF-8\")));\r\n                            try {\r\n                                SLAPI.save(kills, main.this.getDataFolder()\r\n                                        + \"/kills.bin\");\r\n                            } catch (Exception e) {\r\n                                e.printStackTrace();\r\n                            }\r\n                        }\r\n\r\n                        if (join2.getPlayer().getListeningPluginChannels()\r\n                                .contains(\"DeathCount\")) {\r\n                            int deathCount = 0;\r\n                            if (deaths.get(join2.getPlayer().getName()) != null) {\r\n                                deathCount = deaths.get(join2.getPlayer()\r\n                                        .getName());\r\n                            }\r\n                            String deathString = deathCount + \"\";\r\n                            join2.getPlayer().sendPluginMessage(\r\n                                    main.this,\r\n                                    \"DeathCount\",\r\n                                    deathString\r\n                                            .getBytes(java.nio.charset.Charset\r\n                                                    .forName(\"UTF-8\")));\r\n                            try {\r\n                                SLAPI.save(deaths, main.this.getDataFolder()\r\n                                        + \"/deaths.bin\");\r\n                            } catch (Exception e) {\r\n                                e.printStackTrace();\r\n                            }\r\n                        }\r\n                    }\r\n                }, 1L);\r\n\r\n    }\r\n\r\n    @Override\r\n    public boolean onCommand(CommandSender sender, Command cmd, String label,\r\n                             String[] args) {\r\n        if (cmd.getName().equalsIgnoreCase(\"kdclear\")) {\r\n            if (!(sender instanceof Player)) {\r\n                getLogger().info(\"Only a player may use the war command.\");\r\n            } else {\r\n                Player player = (Player) sender;\r\n\r\n                int killCount = 0;\r\n                if (kills.get(player.getName()) != null) {\r\n                    kills.put(player.getName(), killCount);\r\n                }\r\n\r\n                if (player.getListeningPluginChannels().contains(\"KillCount\")) {\r\n                    String killString = killCount + \"\";\r\n                    player.sendPluginMessage(this, \"KillCount\", killString\r\n                            .getBytes(java.nio.charset.Charset.forName(\"UTF-8\")));\r\n                    try {\r\n                        SLAPI.save(kills, this.getDataFolder() + \"/kills.bin\");\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                }\r\n\r\n                int deathCount = 0;\r\n                if (deaths.get(player.getName()) != null) {\r\n                    deaths.put(player.getName(), deathCount);\r\n                }\r\n\r\n                if (player.getListeningPluginChannels().contains(\"KillCount\")) {\r\n                    String deathString = deathCount + \"\";\r\n                    player.sendPluginMessage(this, \"DeathCount\",\r\n                            deathString.getBytes(java.nio.charset.Charset\r\n                                    .forName(\"UTF-8\")));\r\n                    try {\r\n                        SLAPI.save(deaths, this.getDataFolder() + \"/deaths.bin\");\r\n                    } catch (Exception e) {\r\n                        e.printStackTrace();\r\n                    }\r\n                    return false;\r\n                }\r\n            }\r\n\r\n        }\r\n        return true;\r\n    }\r\n\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":8230}]],"length":8230}
